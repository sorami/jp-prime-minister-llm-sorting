## ペアワイズ法 — 二つずつ比較していく

2人ずつペアで比較していきます。プロンプトは以下のような形式です:

```
以下の2人の内閣総理大臣を「左派 ↔ 右派」の軸で比較してください。
改革・変革を志向する左派的な政治姿勢か、伝統・秩序・現状維持を重視する右派的な政治姿勢か

【A】安倍晋三
【B】村山富市

それぞれの人物についてこの軸に関する考察を簡潔に述べた上で、
最後の行に「回答: A」または「回答: B」と、より「左派」寄りの人物を回答してください。
```

実験では全組み合わせ C(64, 2) = 2,016ペアに対して、A/Bの提示順を入れ替えた双方向比較を実施しました（合計4,032回のAPI呼び出し）。

- **一致（勝者確定）**: 1,687ペア（83.7%）
- **不一致（TIE）**: 329ペア（16.3%）

約84%のペアでLLMは提示順に関わらず同じ判断を下しました。不一致の16.3%は、どちらとも言えずLLM自身が迷ったケースとも解釈できます。

なお、4,032回の比較のうち14件（0.35%）で、プロンプトで指定した `回答: A` 形式ではなく独自形式で回答されました。内容はすべて正しく勝者を述べており、パーサーを修正して対応しました。

さらに1件（幣原喜重郎 vs 菅義偉）では、**LLMが回答そのものを拒否**しました。「公的な政治家に対して左派／右派といった政治ラベルを一方的に付与することはお手伝いできません」と前置きしつつ、両者の政策傾向を詳細に比較した上で、最終的な判定だけを出さなかったケースです。興味深いことに、提示順を逆にした比較（菅義偉 vs 幣原喜重郎）では正常に回答しており、同一ペアでも提示順によってセーフティフィルターの発動が変わることがわかります。この1件はTIE扱いにしました。

今回はN=64だからこそ全組み合わせを実行できましたが、Nが大きくなると計算量は $O(N^2)$ で増大し、コストが問題になります。そこで後述のKwikSortでは $O(N \log N)$ の比較回数でソートを行います。

### ポジションバイアスの検証

LLMには選択肢の提示順序によって判断が偏るポジションバイアスが報告されています。

https://tech.legalscape.co.jp/entry/2026/02/04/093000

例えば今回の結果では、佐藤栄作と中曽根康弘の比較で、提示する順番によって結果が異なりました。同じ中曽根が、 `llm(佐藤, 中曽根)` では「右派的・改革志向だが保守ナショナリズムを伴う」と右派寄りに評価され、順序を入れ替えた `llm(中曽根, 佐藤)` では「改革志向が強い」と左派寄りに評価されています。

:::details 佐藤栄作と中曽根康弘の比較 - Chain of Thought 出力

> 【A】佐藤栄作
> \- 基本姿勢：保守・現状維持寄りの安定志向。
> \- 理由：長期政権で経済成長と社会安定を重視し、米日安保の堅持や官僚機構との協調を重視した。沖縄返還など国家主権回復に強い意欲を示した一方、急進的な市場改革や民族主義的な路線は採らず、政策は実務的・現状志向だった。
>
> 【B】中曽根康弘
> \- 基本姿勢：右派的・改革志向だが保守ナショナリズムを伴う。
> \- 理由：行政改革・規制緩和・国鉄民営化推進（民営化路線の旗振り）など市場志向の構造改革を強く推進した一方、教育や歴史認識、皇室礼賛などで保守・国家主義的色彩も強く、イデオロギー的にはより右寄り。
>
> 回答: B

> A 中曽根康弘（1982–87）
> \- 改革志向が強い：行政改革・規制緩和、国鉄分割・民営化（1987）、電電公社（NTT）民営化の推進など、既存制度の改変を積極的に行った。
> \- 政治姿勢は強い国家観・保守色もあるが、政策的には「変える」側面が目立つため、問題の軸では左派寄り（改革志向）と評価できる。
>
> B 佐藤栄作（1964–72）
> \- 安定と秩序の維持を重視：高度経済成長期の安定運営、日米安全保障の堅持、妥協による外交（沖縄返還交渉等）で現状重視の実務主義。
>
> 回答: B

:::

双方向で比較したデータを確認すると、全4,032回の比較において、先に提示された選択肢（A）が勝者に選ばれた割合は **42.1%** でした。50%に近く、今回の実験では**顕著なポジションバイアスは観測されませんでした**。

ちなみに、総当たり比較（後述の勝利数によるランキング）では双方向で比較するためバイアスは相殺されますが、後述のKwikSortでは各ペアを一方向しか比較しないため、提示順序がピボット選択の結果に影響しうる点には注意が必要です。

### 推移性の検証

推移性とは「A < B かつ B < C ならば A < C」が成り立つ性質です。数値の大小比較では自明ですが、LLMの主観的判定では A < B < C < A のような三すくみが起こりえます。

今回のケース（N=64）では、トリプルは C(64, 3) = 41,664 通りあります。

双方向比較で一致した1,687ペアのみ（83.7%）を対象とすると、三すくみはわずか **7組（0.02%）** でした。具体的には以下の7組です（A < B は「AがBより左派」を意味します）:

|   # | 三すくみ（A < B < C < A）                     |
| --: | :-------------------------------------------- |
|   1 | 村山富市 < 大隈重信 < 橋本龍太郎 < 村山富市   |
|   2 | 村山富市 < 原敬 < 橋本龍太郎 < 村山富市       |
|   3 | 広田弘毅 < 田中義一 < 近衛文麿 < 広田弘毅     |
|   4 | 鳩山一郎 < 犬養毅 < 竹下登 < 鳩山一郎         |
|   5 | 鳩山一郎 < 米内光政 < 宇野宗佑 < 鳩山一郎     |
|   6 | 村山富市 < 幣原喜重郎 < 橋本龍太郎 < 村山富市 |
|   7 | 竹下登 < 中曽根康弘 < 岸田文雄 < 竹下登       |

7件中3件（#1, #2, #6）は「村山富市 < ... < 橋本龍太郎 < 村山富市」の辺を共有しており、この2人の比較がループの起点になっていることがわかります。

一方、TIEとなった329ペアにも勝敗を割り当てると三すくみは激増し、`llm(a, b)` 側の結果を採用した場合は **545組（1.31%）**、`llm(b, a)` 側を採用した場合は **685組（1.64%）** となりました。

TIEの解消方法次第で推移律違反が約80〜100倍に膨れ上がることから、曖昧なペアに無理に勝敗をつけることの危うさが見て取れます。とはいえ、それでも全体の1%強にとどまっており、LLMの判定は大部分で一貫していると言えます。

今回の「左派↔右派」という軸はモデルにとって比較的判断しやすく、一貫した結果が得られたのかもしれません。より主観的で解釈が分かれる軸では、違反がさらに増える可能性があります。

### 総当たりの勝利数によるランキング

全ペアの勝敗から勝利数を集計したランキングです。両方向の結果が一致すれば勝者確定、不一致（TIE）は各0.5勝として計上しています。推移律違反の数が多くはないため、このランキングは最適解（矛盾を含むペアワイズ比較結果から最も整合的な全順序を求める問題の解）とほぼ一致すると考えられます。これを手法間比較のベースラインとします。

**ランキング（スコアが高いほど「より右派的」）**

| 勝利数 | 首相名                            |
| -----: | :-------------------------------- |
|    0.0 | 片山哲（1947-1948）               |
|    2.0 | 菅直人（2010-2011）               |
|    4.0 | 鳩山由紀夫（2009-2010）           |
|    4.5 | 細川護熙（1993-1994）             |
|    6.0 | 村山富市（1994-1996）             |
|    ... | （中略）                          |
|   58.0 | 小磯国昭（1944-1945）             |
|   59.0 | 東條英機（1941-1944）             |
|   60.5 | 平沼騏一郎（1939）                |
|   60.5 | 寺内正毅（1916-1918）             |
|   61.5 | 山県有朋（1889-1891 / 1898-1900） |

64名中、同率順位が12組（24人、37.5%）存在します。これはTIEによる0.5勝配分で勝利数が一致するためです。

### KwikSort — ソートアルゴリズムで効率化する

全ペア総当たり（4,032回）は「正解」に近いですが、コストがかかります。そこで、KwikSortアルゴリズムを使います。ランダムにピボットを選び、他の要素をピボットとのペアワイズ比較で左右に分割する操作を再帰的に繰り返します。

今回は全ペアデータがキャッシュ済みのため、seedを変えてもAPIを再度呼び出す必要がありません。そこで seed 0〜99 の**100パターン**を実行して精度と安定性を検証しました。

| 統計量                                | 値                       |
| :------------------------------------ | :----------------------- |
| 平均比較回数                          | 361回（総当たりの17.9%） |
| ベースラインとの平均 Kendall τ        | 0.87                     |
| τ の最小値 / 最大値                   | 0.75 / 0.90              |
| 人物ごとの平均順位変動幅（max - min） | 17.7                     |

**総当たりの約18%の比較回数で τ = 0.87** を達成しており、精度とコストのバランスが良好です。

100回の実行で順位がどれだけ変動するかを見ると、傾向が浮かびます。なお、以下の順位は左派寄りから数えており、1位が最も左派、64位が最も右派です。

![勝利数ソート順位 vs KwikSort順位のブレ幅（100回実行）](https://storage.googleapis.com/zenn-user-upload/e4df0b4203ce-20260217.png)

**最も安定した首相:**

| 首相名                            | 平均順位 | 順位範囲 | 変動幅 |
| :-------------------------------- | -------: | -------: | -----: |
| 片山哲（1947-1948）               |      1.0 |    1 - 1 |      0 |
| 山県有朋（1889-1891 / 1898-1900） |     62.6 |  61 - 64 |      3 |
| 寺内正毅（1916-1918）             |     62.2 |  59 - 64 |      5 |
| 平沼騏一郎（1939）                |     62.0 |  59 - 64 |      5 |
| 小磯国昭（1944-1945）             |     59.5 |  56 - 62 |      6 |

**最も変動が大きい首相:**

| 首相名                              | 平均順位 | 順位範囲 | 変動幅 |
| :---------------------------------- | -------: | -------: | -----: |
| 菅義偉（2020-2021）                 |     31.2 |   6 - 47 |     41 |
| 犬養毅（1931-1932）                 |     25.9 |  18 - 57 |     39 |
| 安倍晋三（2006-2007 / 2012-2020）   |     45.7 |  20 - 54 |     34 |
| 西園寺公望（1906-1908 / 1911-1912） |     18.3 |  11 - 45 |     34 |
| 山本権兵衛（1913-1914 / 1923-1924） |     41.8 |  23 - 54 |     31 |

片山哲は全ペア比較での勝利数が0のため、KwikSortでも100回全てで1位（最も左派）となっています。山県有朋もベースラインで最も右派的とされたのに対し、KwikSortでも61〜64位と極めて安定しており、ランキングの両端は安定しています。

一方、変動が大きい5人はいずれもベースラインで中間付近（平均順位18〜46位）に位置しています。ランキング中間層は勝率が拮抗しているため、ピボット選択や比較順序の違いが順位に大きく影響します。逆に、両端に位置する首相は他の誰と比較されても結果が変わりにくく、安定性が高くなります。
